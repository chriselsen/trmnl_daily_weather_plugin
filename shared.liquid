<style>
  .view--full .weather-image {
    width: 180px;
  }

  .weather-icon {
    width: 50px;
  }

  .weather-icon-mini {
    width: 24px;
  }

  .view--half_vertical .weather-image {
    width: 160px;
  }
</style>

{%liquid
  assign utc_timestamp = trmnl.system.timestamp_utc
  assign local_timestamp = utc_timestamp | plus: timezone_offset
  assign local_hour = local_timestamp | date: "%H" | plus: 0
  assign is_before_noon = false
  if local_hour < 12
    assign is_before_noon = true
  endif
  
  assign image_day = ""
  assign condition = ""
  assign daily_temps_max = ""
  assign daily_temps_min = ""
  assign daily_humidity = ""
  assign daily_rain_prob = ""
  assign daily_uv_index = ""
  assign daily_dates = ""
  
  for i in (0..4)
    if daily[i]
      assign code = daily[i].weather[0].id
      assign temp_max = daily[i].temp.max
      assign temp_min = daily[i].temp.min
      assign humidity = daily[i].humidity
      assign rain_prob = 0
      if daily[i].pop
        assign rain_prob = daily[i].pop | times: 100
      endif
      assign uv_index = daily[i].uvi
      assign date = daily[i].dt
    else
      assign code = 800
      assign temp_max = 20
      assign temp_min = 10
      assign humidity = 50
      assign rain_prob = 0
      assign uv_index = 0
      assign date = utc_timestamp
    endif
    
    assign daily_temps_max = daily_temps_max | append: temp_max | append: ","
    assign daily_temps_min = daily_temps_min | append: temp_min | append: ","
    assign daily_humidity = daily_humidity | append: humidity | append: ","
    assign daily_rain_prob = daily_rain_prob | append: rain_prob | append: ","
    assign daily_uv_index = daily_uv_index | append: uv_index | append: ","
    assign daily_dates = daily_dates | append: date | append: ","
    
    if code == 200 or code == 201 or code == 202
      assign condition = condition | append: "Thunderstorm,"
      assign image_day = image_day | append: "wi-day-thunderstorm.svg,"
    elsif code >= 210 and code <= 221
      assign condition = condition | append: "Lightning,"
      assign image_day = image_day | append: "wi-day-lightning.svg,"
    elsif code >= 230 and code <= 232
      assign condition = condition | append: "Storm,"
      assign image_day = image_day | append: "wi-day-storm-showers.svg,"
    elsif code == 300 or code == 301
      assign condition = condition | append: "Light Drizzle,"
      assign image_day = image_day | append: "wi-day-sprinkle.svg,"
    elsif code >= 302 and code <= 321
      assign condition = condition | append: "Drizzle,"
      assign image_day = image_day | append: "wi-day-rain.svg,"
    elsif code == 500
      assign condition = condition | append: "Light Rain,"
      assign image_day = image_day | append: "wi-day-sprinkle.svg,"
    elsif code == 501
      assign condition = condition | append: "Moderate Rain,"
      assign image_day = image_day | append: "wi-day-rain.svg,"
    elsif code == 502 or code == 503
      assign condition = condition | append: "Heavy Rain,"
      assign image_day = image_day | append: "wi-day-rain.svg,"
    elsif code == 504
      assign condition = condition | append: "Extreme Rain,"
      assign image_day = image_day | append: "wi-day-rain.svg,"
    elsif code >= 511 and code <= 531
      assign condition = condition | append: "Showers,"
      assign image_day = image_day | append: "wi-day-showers.svg,"
    elsif code == 600
      assign condition = condition | append: "Light Snow,"
      assign image_day = image_day | append: "wi-day-snow.svg,"
    elsif code == 601
      assign condition = condition | append: "Snow,"
      assign image_day = image_day | append: "wi-day-snow.svg,"
    elsif code == 602
      assign condition = condition | append: "Heavy Snow,"
      assign image_day = image_day | append: "wi-day-snow.svg,"
    elsif code >= 611 and code <= 622
      assign condition = condition | append: "Sleet,"
      assign image_day = image_day | append: "wi-day-sleet.svg,"
    elsif code == 701
      assign condition = condition | append: "Mist,"
      assign image_day = image_day | append: "wi-day-fog.svg,"
    elsif code == 711
      assign condition = condition | append: "Smoke,"
      assign image_day = image_day | append: "wi-smoke.svg,"
    elsif code == 721
      assign condition = condition | append: "Haze,"
      assign image_day = image_day | append: "wi-day-haze.svg,"
    elsif code == 731 or code == 761
      assign condition = condition | append: "Dust,"
      assign image_day = image_day | append: "wi-dust.svg,"
    elsif code == 741
      assign condition = condition | append: "Fog,"
      assign image_day = image_day | append: "wi-day-fog.svg,"
    elsif code == 751
      assign condition = condition | append: "Sand,"
      assign image_day = image_day | append: "wi-sandstorm.svg,"
    elsif code == 762
      assign condition = condition | append: "Ash,"
      assign image_day = image_day | append: "wi-volcano.svg,"
    elsif code == 771
      assign condition = condition | append: "Squall,"
      assign image_day = image_day | append: "wi-strong-wind.svg,"
    elsif code == 781
      assign condition = condition | append: "Tornado,"
      assign image_day = image_day | append: "wi-tornado.svg,"
    elsif code == 800
      assign image_day = image_day | append: "wi-day-sunny.svg,"
      assign condition = condition | append: "Clear,"
    elsif code == 801
      assign condition = condition | append: "Few Clouds,"
      assign image_day = image_day | append: "wi-day-sunny-overcast.svg,"
    elsif code == 802
      assign condition = condition | append: "Scattered Clouds,"
      assign image_day = image_day | append: "wi-day-cloudy.svg,"
    elsif code == 803
      assign condition = condition | append: "Broken Clouds,"
      assign image_day = image_day | append: "wi-day-cloudy.svg,"
    elsif code == 804
      assign condition = condition | append: "Overcast,"
      assign image_day = image_day | append: "wi-cloudy.svg,"
    else
      assign condition = condition | append: "Unknown,"
      assign image_day = image_day | append: "wi-day-sunny.svg,"
    endif
  endfor
  
  assign image_day = image_day | split: ","
  assign condition = condition | split: ","
  assign daily_temps_max = daily_temps_max | split: ","
  assign daily_temps_min = daily_temps_min | split: ","
  assign daily_humidity = daily_humidity | split: ","
  assign daily_rain_prob = daily_rain_prob | split: ","
  assign daily_uv_index = daily_uv_index | split: ","
  assign daily_dates = daily_dates | split: ","
  assign update_time = local_timestamp
%}